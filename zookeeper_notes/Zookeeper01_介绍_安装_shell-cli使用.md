# Zookeeper

## 介绍

完成分布式的协调是一件很难的事情。在Redis击穿和穿透的时候都需要分布式锁。Redis数据没有了的时候，很多并发这时候到达了，尽量的不把并发的请求透穿到数据库里去。这样就需要在数据库前面卡一下：第一个过来的人抢一把锁，后面的没抢到锁
所以就在那里阻塞着（有点像自旋锁），第一个人抢到锁之后就去后面的数据库拿到数据，并放入缓存，其他人等时间到了之后再去Redis把数据取走。所以即便是数据有穿透，这么大的并发也不是一下子全压过去，而只是压过去了一笔。但是这个事做起来
太麻烦了，这一点在Redis里面讲过。zookeeper现在要做的就是这个分布式协调, 而且zookeeper的数据也是保存在内存中的，也能类比Redis.Zookeeper也一般是一个集群，一谈到集群就是主从复制集群或者无主集群，要么就是镜像拷贝的，要么
就是sharding分片的集群。zk属于主从复制集群，zk好多进程分布在不同的节点，每个节点的数据都一样的，server中个leader，类比主从复制的Redis集群，zk也是主节点可以增删改查，从节点只能读。当我们一看到主从集群的时候，条件反射地就
应该反应出 ----- 单点问题. 客户端想连谁就连谁，写操作在leader这里，但是读操作在任何节点。所以连到从节点却要执行写操作的话会转到leader。leader一旦挂掉是可以快速自我修复的，zk集群极其高可用。如果有一种方式可以快速恢复出一
个leader，集群就有恢复到了可用的状态。zk leader挂掉的时候，进入无主状态，此时所有的请求操作都没有了，集群不可用，关门了，不对外提供服务。从不可用状态恢复到可用状态速度越快越好。zk选择新领导者的时间不到200ms。zk做读写分离
读写之比为10:1做有的时候读的速度是非常快的，跟Redis类似，都发生在内存，单进程在一个物理机上每秒能hold住100000请求。  

zk在内存中是树状文件结构，与一般的文件系统不同的是每个节点都可以存数据，最大1M。强调：不要把zk当做数据库用，速度快的言外之意是传输的数据体量变小。Redis可以当做数据库用，但是zk不行