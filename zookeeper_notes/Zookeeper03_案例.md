# Zookeeper 案例

zk最大的好处是，只要你watch他了，他一旦有修改就会回调你注册的方法，等于是第一时间就知道什么东西被修改了。所以可以用作分布式配置。除了分布式配置中心，dubbo也是使用了zk的回调方式，zk还可以实现分布式锁。分布式锁的面试并不在它本身，
关键是这个知识能引出很多其他的知识点：  

1.分布式配置。又叫注册中心、注册发现。如果有一台（或多台）服务器，在启动的时候，需要一些配置。或者他们在运行的时候有些配置变更了，他们要第一时间获知（有点像发布订阅的场景），这个成本要降到最低。所以我们把数据存到zk中，client可以
通过get方式主动取回配置信息；也可以通过watch，被动等zookeeper被watch的节点的更新通知（watch的回调）。

2.分布式锁。zk高可用，数据视图是统一的，连哪个节点都可以。Redis就别想了，不能开启日志，因为那样就慢下来了；Redis也可能有单点问题，挂了之后可能重复获得锁。 1.争抢锁：唯一性，只有一个人能获得锁。2.获的锁的人没完成就挂了的话会成
	为死锁，可以使用zk的临时节点，他是伴随客户端的session的, 客户端断开连接之后锁自动就消失了，所以挂掉的话也不会产生死锁。3.获得锁的人成功了，释放锁。4. 锁释放了、删除了，别人怎么知道？4-1：其他的人写个死循环每隔一秒钟去看一
	眼这把锁能不能获取（主动轮询，心跳），弊端是延迟，实时性不够强，而且客户端太多的话会对zk服务器造成比较大的压力。4-2: watcher: 解决延迟的问题，但是弊端是如果有1000台来抢，一台抢到，断开的时候zk会回调另外999台。他们又开始
	发起新的一轮抢锁，在通信上会有压力。4-3: 临时序列节点 + watcher，后一个watch前一个，最小的获得锁，第二个watch第一个，第三个watch第二个。。。一旦最小的释放了锁，成本是zk只给第二个发事件回调